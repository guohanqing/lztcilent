/************************************************* 
  Copyright (C), 2012, NJUT
  File name:      gprsio.c
  Author:  sundm     Version:  1.0      Date: 2013.1.3 
  Description:    sundm GPRSÄ£¿éÇı¶¯½Ó¿Úº¯Êı 
  Others:        ²ÉÓÃµ×²ãÇı¶¯£¬Ìî³äº¯Êı  
  Function List:  
*************************************************/ 

#ifndef _ESP8266_H_
#define _ESP8266_H_

#include <rtthread.h>
#include "stm32f1xx.h"

//#define ESP8266_RCC_GPIO_CLK_ENABLE()  	__HAL_RCC_GPIOB_CLK_ENABLE()
//#define ESP8266_CS_PORT              	GPIOB
//#define ESP8266_CS_PIN               	GPIO_PIN_4

#define PB4 					  90 // PB4 Pin is NO. 90 @STM32F103VET6

#define	ESP8266_CS_Init() 		rt_pin_mode(PB4, PIN_MODE_OUTPUT)
#define ESP8266_CS_LOW()		rt_pin_write(PB4,PIN_LOW)
#define ESP8266_CS_HIGH()		rt_pin_write(PB4,PIN_HIGH)

#define ESP8266_USARTx 		"uart3"

//¶¨ÒåATÖ¸Áî

#define WIFI_LIST_AP_MAX 				5

#define WIFI_LIST   				0x20
#define WIFI_JAP    				0x21
#define WIFI_QAP    				0x22
#define WIFI_SEND_DATA   		0x23
#define WIFI_JAP_STATUS 		0x24
#define WIFI_CONNECT_SEVER 	0x25


//typedef int LINK_STATUS;


//#define JAP_FAL 1
//#define JAP_OK  2
//#define CONNECT_SEVER_FAL  3
//#define CONNECT_SEVER_OK  4
<<<<<<< HEAD

=======
>>>>>>> 6ddc77ea895ec3fe38c9bb42d02db39e52808a73

#define CMD_SEND_FP 					0x03	//é‡‡é›†æŒ‡çº¹ä¿¡æ¯
#define CMD_SEND_USER_PHONE_NUM 		0x04	//å‘é€æ‰‹æœºå
#define CMD_SEND_USER_PHONE_CHECK		0x07	//å‘é€éªŒè¯ç 
#define CMD_PAY_NUM 					0x08	//è®¾å¤‡å‘é€æ¶ˆè´¹é‡‘é¢
#define CMD_SEND_UDID 					0x09	//å‘é€èº«ä»½è¯†åˆ«ç 
#define CMD_SEND_TICK 					0x0A	//å¿ƒè·³
#define CMD_CHECK_TIME          		0x0E	////æ—¶é—´æ ¡å¯¹
#define CMD_SEND_OWNER_PHONE_NUM  		0xE8	//å‘é€ç»‘å®šæ‰‹æœºå·
#define CMD_SEND_OWNER_PHONE_CHECK 		0xEB	//å‘é€ç»‘å®šéªŒè¯ç 
#define CMD_UPDATA 						0x0F	//è¿œç¨‹å‡çº§
	
#define CMD_SEND_FP 					0x03	//é‡‡é›†æŒ‡çº¹ä¿¡æ¯
#define CMD_SEND_USER_PHONE_NUM 		0x04	//å‘é€æ‰‹æœºå
#define CMD_SEND_USER_PHONE_CHECK		0x07	//å‘é€éªŒè¯ç 
#define CMD_PAY_NUM 					0x08	//è®¾å¤‡å‘é€æ¶ˆè´¹é‡‘é¢
#define CMD_SEND_UDID 					0x09	//å‘é€èº«ä»½è¯†åˆ«ç 
#define CMD_SEND_TICK 					0x0A	//å¿ƒè·³
#define CMD_CHECK_TIME          		0x0E	////æ—¶é—´æ ¡å¯¹
#define CMD_SEND_OWNER_PHONE_NUM  		0xE8	//å‘é€ç»‘å®šæ‰‹æœºå·
#define CMD_SEND_OWNER_PHONE_CHECK 		0xEB	//å‘é€ç»‘å®šéªŒè¯ç 
#define CMD_UPDATA 						0x0F	//è¿œç¨‹å‡çº§
	
#if 1
#define ESP8266_ATCMD "AT\x0D\x0A"               // AT²éÑ¯
#define ESP8266_RESET "AT+RST\x0D\x0A"           // Ä£¿é¸´Î»

#define ESP8266_CWMODE_STA "AT+CWMODE=1\x0D\x0A"      // Ñ¡ÔñWiFiÓ¦ÓÃÄ£Ê½  StationÄ£Ê½
#define ESP8266_CWMODE_AP "AT+CWMODE=2\x0D\x0A"      // Ñ¡ÔñWiFiÓ¦ÓÃÄ£Ê½  APÄ£Ê½
#define ESP8266_CWMODE_APSTA "AT+CWMODE=3\x0D\x0A"      // Ñ¡ÔñWiFiÓ¦ÓÃÄ£Ê½  Station+APÄ£Ê½

#define ESP8266_CWLAP "AT+CWLAP\x0D\x0A"      // ÁĞ³öµ±Ç°½ÓÈëµã
#define ESP8266_CWQAP "AT+CWQAP\x0D\x0A"      // ÍË³ö
#define ESP8266_CIFSR "AT+CIFSR\x0D\x0A"      // »ñÈ¡±¾µØIPµØÖ·
//#define ESP8266_CWJAP "AT+CWJAP=\"lzt02\",\"lzt123456\"\x0D\x0A"

#define ESP8266_CWJAP "AT+CWJAP=\"lzt02\",\"lzt123456\"\x0D\x0A"      // ¼ÓÈë½ÓÈëµã TP-LINK_sundm
#define ESP8266_CIPEXITSERVER "AT+CIPSERVER=0\x0D\x0A"      // ÍË³öserver
#define ESP8266_CIPMUX "AT+CIPMUX=0\x0D\x0A"      // ÉèÖÃµ¥Á¬½Ó
#define ESP8266_CIPMODE "AT+CIPMODE=1\x0D\x0A"      // ÉèÖÃÍ¸´«Ä£Ê½

#define ESP8266_CIPSTART "AT+CIPSTART=\"TCP\",\"192.168.2.102\",8080\x0D\x0A"      // ½¨Á¢TCP/UDPÁ¬½Ó
#define ESP8266_CIPSTATUS "AT+CIPSTATUS\x0D\x0A"      // »ñµÃTCP/UDPÁ¬½Ó×´Ì¬
#define ESP8266_CIP_JAP_STATUS "AT+CWJAP?\x0D\x0A"
#define ESP8266_CIPSEND "AT+CIPSEND\x0D\x0A"      // ·¢ËÍÊı¾İ

#define ESP8266_CIPCLOSE "AT+CIPCLOSE\x0D\x0A"      // ¹Ø±ÕTCP/UDPÁ¬½Ó
#define ESP8266_CIPMODE_CLOSED "+++"      // ¹Ø±ÕÍ¸´«
#define ESP8266_CWLAPOPT "AT+CWLAPOPT=0,7\x0D\x0A"                   //ÉèÖÃcwlapµÄÏÔÊ¾ÊôĞÔ 1(0)(²»)¸ù¾İĞÅºÅÇ¿¶ÈÅÅĞò(bit6)(bit5)(bit4)ch(bit3)mac(bit2)ĞÅºÅÇ¿¶È(bit1)ssid(bit0)¼ÓÃÜ·½Ê½
#endif

<<<<<<< HEAD

enum LINK_STATUS
{
    WIFI_LINK_JAP_FAILD = 1,
    WIFI_LINK_JAP_OK,
    WIFI_LINK_CONNECT_SEVER_FAILD,
    WIFI_LINK_CONNECT_SEVER_OK
=======
enum LINK_STATUS
{
	WIFI_LINK_JAP_FAILD = 1,
	WIFI_LINK_JAP_OK,
	WIFI_LINK_CONNECT_SEVER_FAILD,
	WIFI_LINK_CONNECT_SEVER_OK
>>>>>>> 6ddc77ea895ec3fe38c9bb42d02db39e52808a73
};

typedef struct link_ip
{
    char IP1[4];
    char IP2[4];
    char IP3[4];
    char IP4[4];
    char PORT[6];
<<<<<<< HEAD
}link_ip_t;
	
union link_sever_ip
{
    link_ip_t ip;
    char      ip_buf[22];  
};
	
typedef struct sever_frame_package
{
    rt_uint16_t frame_head;
    rt_uint16_t frame_data_len;
    rt_uint32_t  id;
    char  SEQ;	/*åºå·é»˜è®¤01*/      
    char  DESC;  /*ä»…é‡‡é›†æŒ‡çº¹ä¿¡æ¯ä½¿ç”¨ï¼ˆ1-ç¬¬ä¸€æ¬¡é‡‡é›†ï¼›2-ç¬¬äºŒæ¬¡é‡‡é›†æŒ‡çº¹ä¿¡æ¯ï¼›3-ç¬¬ä¸‰æ¬¡æŒ‡çº¹é‡‡é›†ä¿¡æ¯ï¼‰é»˜è®¤0*/
    char  CMD;  /*æ¶ˆæ¯ç±»å‹*/
    char        *pdata;
    rt_uint8_t   check;/*ä»æ•°æ®é•¿åº¦å¼€å§‹åˆ°æ ¡éªŒç ä¹‹å‰çš„æ•°æ®çš„å¼‚æˆ–æ ¡éª¯*/
=======
}link_ip_t;	
	
typedef struct sever_frame_package
{
		rt_uint16_t frame_head;
		rt_uint16_t frame_data_len;
	    rt_uint32_t  id;
		char  SEQ;	 /* åºå·é»˜è®¤01 */      
		char  DESC;  /* ä»…é‡‡é›†æŒ‡çº¹ä¿¡æ¯ä½¿ç”¨ï¼ˆ1-ç¬¬ä¸€æ¬¡é‡‡é›†ï¼›2-ç¬¬äºŒæ¬¡é‡‡é›†æŒ‡çº¹ä¿¡æ¯ï¼›3-ç¬¬ä¸‰æ¬¡æŒ‡çº¹é‡‡é›†ä¿¡æ¯ï¼‰é»˜è®¤0 */
		char  CMD;   /* æ¶ˆæ¯ç±»å‹ */
		char        *pdata;
	    rt_uint8_t   check;/* ä»æ•°æ®é•¿åº¦å¼€å§‹åˆ°æ ¡éªŒç ä¹‹å‰çš„æ•°æ®çš„å¼‚æˆ–æ ¡éª */
>>>>>>> 6ddc77ea895ec3fe38c9bb42d02db39e52808a73
}sever_frame_package_t;

typedef struct sever_frame_package_char
{
<<<<<<< HEAD
    char frame_head[2];
    char frame_data_len[2];
    char  id[3];
    char  SEQ;	/*åºå·é»˜è®¤01*/      
    char  DESC;  /*ä»…é‡‡é›†æŒ‡çº¹ä¿¡æ¯ä½¿ç”¨ï¼ˆ1-ç¬¬ä¸€æ¬¡é‡‡é›†ï¼›2-ç¬¬äºŒæ¬¡é‡‡é›†æŒ‡çº¹ä¿¡æ¯ï¼›3-ç¬¬ä¸‰æ¬¡æŒ‡çº¹é‡‡é›†ä¿¡æ¯ï¼‰é»˜è®¤0*/
    char  CMD;  /*æ¶ˆæ¯ç±»å‹*/
    char        *pdata;
    rt_uint8_t   check;/*ä»æ•°æ®é•¿åº¦å¼€å§‹åˆ°æ ¡éªŒç ä¹‹å‰çš„æ•°æ®çš„å¼‚æˆ–æ ¡éª¯*/
}sever_frame_package_char_t;
union frame_package
=======
		char frame_head[2];
		char frame_data_len[2];
	    char  id[3];
		char  SEQ;	 /* åºå·é»˜è®¤01 */      
		char  DESC;  /* ä»…é‡‡é›†æŒ‡çº¹ä¿¡æ¯ä½¿ç”¨ï¼ˆ1-ç¬¬ä¸€æ¬¡é‡‡é›†ï¼›2-ç¬¬äºŒæ¬¡é‡‡é›†æŒ‡çº¹ä¿¡æ¯ï¼›3-ç¬¬ä¸‰æ¬¡æŒ‡çº¹é‡‡é›†ä¿¡æ¯ï¼‰é»˜è®¤0 */
		char  CMD;   /* æ¶ˆæ¯ç±»å‹ */
		char        *pdata;
	    rt_uint8_t   check;/* ä»æ•°æ®é•¿åº¦å¼€å§‹åˆ°æ ¡éªŒç ä¹‹å‰çš„æ•°æ®çš„å¼‚æˆ–æ ¡éª */
}sever_frame_package_char_t;

union package_send
>>>>>>> 6ddc77ea895ec3fe38c9bb42d02db39e52808a73
{
      sever_frame_package_char_t   frame;
      char 					       buf[16];
};
<<<<<<< HEAD
=======
	
union link_sever_ip
{
    link_ip_t ip;
    char      ip_buf[22];  
};
>>>>>>> 6ddc77ea895ec3fe38c9bb42d02db39e52808a73

typedef struct wifi_list
{
	char ecn[1];
	char ssid[32];
	int  rssi;
}wifi_list_t;

extern wifi_list_t  wifi_list_AP[WIFI_LIST_AP_MAX];
extern wifi_list_t  connected_ap;

rt_err_t send_frame_package(rt_uint8_t cmd,rt_uint8_t desc,char *args);

rt_err_t send_frame_package(rt_uint8_t cmd,rt_uint8_t desc,char *args);

#endif
